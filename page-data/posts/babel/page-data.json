{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/babel/","result":{"data":{"markdownRemark":{"id":"417c8c3f-c4da-587d-ac08-d757046fd731","html":"<h2 id=\"바벨에-관한-이것저것-모음\"><a href=\"#%EB%B0%94%EB%B2%A8%EC%97%90-%EA%B4%80%ED%95%9C-%EC%9D%B4%EA%B2%83%EC%A0%80%EA%B2%83-%EB%AA%A8%EC%9D%8C\" aria-label=\"바벨에 관한 이것저것 모음 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바벨에 관한 이것저것 모음</h2>\n<p>바벨은 컴파일러이다. 자바스크립트를 입력받아 자바스크립트를 출력한다.\n예를 들면, es6코드를 받아서 브라우저에서 돌아갈 수 있는 es5코드로 바꿔주는 것이다.</p>\n<p>나의 프로젝트중 package.json에서 웹팩, 바벨 관련 dependency만 추려보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@babel/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@babel/preset-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"babel-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^8.0.6\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"css-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"file-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"html-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.5.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"html-webpack-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.2.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"mini-css-extract-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.8.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"node-sass\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.12.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sass-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.38.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack-cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.3.6\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack-dev-server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.7.2\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"babel-loader\"><a href=\"#babel-loader\" aria-label=\"babel loader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>babel-loader</h3>\n<p>프로젝트에 es6이상의 문법을 사용하고 싶다면, 바벨 설정이 필요하다.\n바벨의 컴파일을 거쳐 build 되도록 해야하는데 여러가지 방법이 있다.\n그 중 나는 웹팩의 babel-loader로 바벨을 실행시킨다.</p>\n<p>webpack.config.js 의 module.roules의 설정에 아래와 같이 추가한다.\nnode_modules 폴더 빼고 모든 js 파일에 babel 컴파일을 거치도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n    exclude<span class=\"token punctuation\">:</span> <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">,</span>\n    use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h3 id=\"환경-설정\"><a href=\"#%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"환경 설정 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경 설정</h3>\n<p>일단 스크립트에 개발 환경을 설정하기 위해 package.json의 scripts 부분 수정.\n<code class=\"language-text\">NODE_ENV</code> 키로 값을 줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;scripts&quot;: {\n    &quot;start&quot;: &quot;webpack-dev-server&quot;,\n    &quot;build&quot;: &quot;rm -rf dist &amp;&amp; NODE_ENV=production webpack&quot;\n},</code></pre></div>\n<p>웹팩에서 현재 모드는 <code class=\"language-text\">process.env.NODE_ENV</code> 로 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mode <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 예를 들어 위와 같이 값을 가져와서 사용</span></code></pre></div>\n<p>바벨에서는 env 속성을 이용하면 환경별로 다른 설정을 줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// babel.config.js</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"production\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"minify\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"바벨과-폴리필\"><a href=\"#%EB%B0%94%EB%B2%A8%EA%B3%BC-%ED%8F%B4%EB%A6%AC%ED%95%84\" aria-label=\"바벨과 폴리필 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바벨과 폴리필</h3>\n<p>자바스크립트의 최신 기능을 모두 사용하면서 오래된 브라우저를 지원하려면 바벨로 코드 문법도 변환해야하고, 폴리필을 직접 사용해야 하는 것도 있다.\n폴리필은 런타임에 기능을 주입한다.\n바벨을 사용한다고 해서 js 모든 최신기능을 사용할 수 있는 것은 아니므로 폴리필 설정은 별도로 해야한다.</p>\n<p>참고록 async await는 폴리필로 추가할 수 없으며, 컴파일 타임에 코드 변환을 해야한다.</p>\n<p><strong>@babel/polyfill</strong></p>\n<p>해당 모듈을 import하거나 webpack에 설정할 경우, 모든 폴리필이 포함되어 필요하지 않은 것도 가져오므로 번들 파일의 크기가 커진다.</p>\n<p><strong>core-js</strong></p>\n<p>@babel/polyfill 패키지는 내부적으로 core-js 패키지를 이용한다. 이 중에서 필요한 폴리필만 가져오면 번들 파일의 크기를 줄일 수 있다.</p>\n<p><strong>@babel/preset-env</strong></p>\n<p>실행 환경에 대한 정보를 설정하면 자동으로 필요한 기능을 주입해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// babel.config.js</span>\n<span class=\"token keyword\">const</span> presets <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        '@babel<span class=\"token operator\">/</span>preset<span class=\"token operator\">-</span>env`<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            targets<span class=\"token punctuation\">:</span> <span class=\"token string\">'> 0.25%, not dead'</span><span class=\"token punctuation\">,</span>\n            useBuiltIns<span class=\"token punctuation\">:</span> <span class=\"token string\">'usage'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위는 시장 점유율이 0.25% 이상이고 업데이트가 종료되지 않은 브라우저를 의미한다.\n브라우저 정보는 browserlist라는 패키지의 문법을 사용하므로, 해당 사이트에 가면 어떤 브라우저인지 잘 나와있다.\n<code class=\"language-text\">useBuiltIns: &#39;usage&#39;</code>는 각 js파일에서 실제 사용한것만 polyfill로 가져온다는 의미이다.\n이 설정이 없으면 시장 점유율이 0.25% 이상인 브라우저를 위한 모든 polyfill이 추가된다.</p>\n<h3 id=\"바벨-설정-관련\"><a href=\"#%EB%B0%94%EB%B2%A8-%EC%84%A4%EC%A0%95-%EA%B4%80%EB%A0%A8\" aria-label=\"바벨 설정 관련 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바벨 설정 관련</h3>\n<ul>\n<li>extends: 다른 설정 파일을 가져와서 확장할 수 있다.</li>\n<li>env, overrides: 환경별 또는 파일별로 다른 설정을 적용할 수 있다.</li>\n</ul>\n<h2 id=\"72-바벨-플러그인-제작하기\"><a href=\"#72-%EB%B0%94%EB%B2%A8-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%A0%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\"72 바벨 플러그인 제작하기 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7.2 바벨 플러그인 제작하기</h2>\n<h3 id=\"721-ast-구조\"><a href=\"#721-ast-%EA%B5%AC%EC%A1%B0\" aria-label=\"721 ast 구조 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7.2.1 AST 구조</h3>\n<p>바벨은 문자열로 입력되는 코드를 AST(abstract syntax tree)라는 구조체로 만들어서 처리한다.\n플러그인에서는 AST를 기반으로 코드를 변경한다.</p>\n<h4 id=\"바벨-컴파일-단계\"><a href=\"#%EB%B0%94%EB%B2%A8-%EC%BB%B4%ED%8C%8C%EC%9D%BC-%EB%8B%A8%EA%B3%84\" aria-label=\"바벨 컴파일 단계 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바벨 컴파일 단계</h4>\n<ul>\n<li>파싱(parse): 입력된 코드로부터 AST(abstract syntax tree) 생성</li>\n<li>변환(transform): AST를 원하는 형태로 변환</li>\n<li>생성(generate): AST를 코드로 출력</li>\n</ul>\n<blockquote>\n<p>AST는 코드의 구문(syntax)이 분석된 결과를 담고 있는 구조체다.\n코드가 같다면 AST도 같기 때문에 같은 코드에 대해서 하나의 AST를 만들어 놓고 재사용할 수 있다.</p>\n</blockquote>\n<p><a href=\"https://astexplorer.net/\">astexplorer</a> 사이트에서 AST 구조를 확인할 수 있다.\n이렇게 구조가 만들어진다니.. 처음 봤다!</p>\n<p>책에서 나온대로 <code class=\"language-text\">const v1 = a + b;</code> 한 줄 파싱해봤을 뿐인데 우측에 엄청 긴 AST 가 생성되었다.</p>\n<p>이러한 AST 구조를 파악해야만 바벨 플러그인을 만들 수 있다. 해당 구조를 원하는 형태로 변환하여 다시 코드로 배출하기 때문이다.\n<del>멘토라면 이런것쯤은 껌으로 알아야할까? 상당히 어색하다. 바벨 플러그인은 내년에나 만들어봐야겠다.</del></p>\n<h3 id=\"reference\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reference</h3>\n<p>실전리액트프로그래밍</p>","fields":{"slug":"/posts/babel/","tagSlugs":["/tag/babel/"]},"frontmatter":{"date":"2019-10-23T04:46:32.169Z","description":"실전 리액트 프로그래밍 7.1, 7.2 정리","tags":["babel"],"title":"바벨(babel)"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/babel/"}}}